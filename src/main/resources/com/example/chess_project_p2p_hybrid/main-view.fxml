<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.scene.shape.*?>
<StackPane maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" prefHeight="750.0"
           prefWidth="1300.0" xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.example.chess_project_p2p_hybrid.client.controller.MainController">
    <children>
        <AnchorPane>
            <children>

                <!-- 1. Sidebar trái (VBox) -->
                <VBox prefHeight="750.0" prefWidth="200.0"
                      style="-fx-background-color: linear-gradient(to bottom, #1f2a38, #243447); -fx-padding: 18 0; -fx-spacing: 10;">
                    <children>

                        <Label alignment="CENTER" prefHeight="60.0" prefWidth="200.0"
                               style="-fx-text-fill: linear-gradient(to right, #3498db, #2ecc71); -fx-padding: 0 0 10 0; -fx-font-weight: bold; -fx-font-size: 28px; -fx-font-family: 'Segoe UI Black'; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.3), 10, 0, 0, 2);"
                               text="CHESS P2P">
                            <font>
                                <Font name="System Bold" size="28.0"/>
                            </font>
                        </Label>

                        <!-- User Profile Section -->
                        <HBox alignment="CENTER_LEFT" spacing="15" style="-fx-background-color: rgba(0,0,0,0.1);">
                            <children>
                                <StackPane>
                                    <Circle fill="#3498db" radius="25.0" stroke="WHITE" strokeType="INSIDE" strokeWidth="2.0"/>
                                    <Label fx:id="userAvatarLabel" text="U" textFill="WHITE">
                                        <font>
                                            <Font name="System Bold" size="22.0"/>
                                        </font>
                                    </Label>
                                </StackPane>
                                <VBox alignment="CENTER_LEFT" spacing="2">
                                    <Label fx:id="userNameLabel" text="Khách" textFill="WHITE">
                                        <font>
                                            <Font name="System Bold" size="16.0"/>
                                        </font>
                                    </Label>
                                    <HBox alignment="CENTER_LEFT" spacing="6">
                                        <Circle fill="#2ecc71" radius="4.0" stroke="BLACK" strokeType="INSIDE" strokeWidth="0.0"/>
                                        <Label text="Online" textFill="#bdc3c7">
                                            <font>
                                                <Font size="12.0"/>
                                            </font>
                                        </Label>
                                    </HBox>
                                </VBox>
                            </children>
                            <padding>
                                <Insets bottom="15.0" left="20.0" right="20.0" top="15.0"/>
                            </padding>
                        </HBox>
                        <Button fx:id="homeButton" mnemonicParsing="false" prefHeight="46.0" prefWidth="200.0"
                                style="-fx-text-fill: #ecf0f1; -fx-background-color: transparent; -fx-font-size: 16px; -fx-alignment: center-left; -fx-padding: 12 28; -fx-max-width: infinity;"
                                text="Trang chủ">
                            <font>
                                <Font size="16.0"/>
                            </font>
                        </Button>
                        <Button fx:id="pvpButton" mnemonicParsing="false" prefHeight="46.0" prefWidth="200.0"
                                style="-fx-text-fill: #ecf0f1; -fx-background-color: transparent; -fx-font-size: 16px; -fx-alignment: center-left; -fx-padding: 12 28; -fx-max-width: infinity;"
                                text="Đấu người (PvP)">
                            <font>
                                <Font size="16.0"/>
                            </font>
                        </Button>
                        <Button fx:id="pvcButton" mnemonicParsing="false" prefHeight="46.0" prefWidth="200.0"
                                style="-fx-text-fill: #ecf0f1; -fx-background-color: transparent; -fx-font-size: 16px; -fx-alignment: center-left; -fx-padding: 12 28; -fx-max-width: infinity;"
                                text="Đấu máy (PvC)">
                            <font>
                                <Font size="16.0"/>
                            </font>
                        </Button>
                        <Button fx:id="chatButton" mnemonicParsing="false" prefHeight="46.0" prefWidth="200.0"
                                style="-fx-text-fill: #ecf0f1; -fx-background-color: transparent; -fx-font-size: 16px; -fx-alignment: center-left; -fx-padding: 12 28; -fx-max-width: infinity;"
                                text="Phòng chat">
                            <font>
                                <Font size="16.0"/>
                            </font>
                        </Button>
                        <Button fx:id="howToPlayButton" mnemonicParsing="false" prefHeight="46.0" prefWidth="200.0"
                                style="-fx-text-fill: #ecf0f1; -fx-background-color: transparent; -fx-font-size: 16px; -fx-alignment: center-left; -fx-padding: 12 28; -fx-max-width: infinity;"
                                text="Hướng dẫn chơi">
                            <font>
                                <Font size="16.0"/>
                            </font>
                        </Button>
                        <Pane VBox.vgrow="ALWAYS"/>
                        <Button fx:id="exitButton" mnemonicParsing="false" prefHeight="46.0" prefWidth="200.0"
                                style="-fx-text-fill: #e74c3c; -fx-background-color: rgba(231, 76, 60, 0.15); -fx-font-size: 16px; -fx-alignment: center-left; -fx-padding: 12 28; -fx-max-width: infinity; -fx-background-radius: 0;"
                                text="Thoát">
                            <font>
                                <Font size="16.0"/>
                            </font>
                            <VBox.margin>
                                <Insets bottom="10.0"/>
                            </VBox.margin>
                        </Button>
                    </children>
                </VBox>

                <!-- 2. Bàn cờ chính (Khu vực giữa) -->
                <AnchorPane layoutX="200.0" prefHeight="750.0" prefWidth="750.0" style="-fx-background-color: #bdc3c7;">
                    <StackPane prefHeight="750.0" prefWidth="750.0">
                        <VBox alignment="CENTER" prefHeight="750.0" prefWidth="750.0">

                            <!-- Tên Người chơi ĐEN (Trên) -->
                            <AnchorPane prefHeight="26.0" prefWidth="750.0"
                                        style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #333333; ">
                                <children>
                                    <Label fx:id="blackPlayerName" alignment="CENTER_LEFT" layoutX="73.0" layoutY="5.0"
                                           maxWidth="Infinity" text="Người chơi 2 (Đen):"/>
                                    <Label fx:id="lNameBlack" alignment="CENTER_LEFT" layoutX="263.0" layoutY="6.0"
                                           maxWidth="Infinity" text="Đang chờ..."/>
                                    <Label fx:id="blackTimerLabel" alignment="CENTER_RIGHT" layoutX="600.0" layoutY="5.0" text="10:00" style="-fx-text-fill: #c0392b;" />
                                </children>
                            </AnchorPane>

                            <!-- KHU VỰC BÀN CỜ VÀ TỌA ĐỘ -->
                            <GridPane alignment="CENTER" hgap="0" prefHeight="650.0" prefWidth="650.0" vgap="0">
                                <!-- Column Constraints: 25px | 600px | 25px. Bàn cờ 8x75px = 600px -->
                                <columnConstraints>
                                    <ColumnConstraints halignment="CENTER" minWidth="25.0" prefWidth="25.0"/>
                                    <ColumnConstraints halignment="CENTER" minWidth="600.0" prefWidth="600.0"/>
                                    <ColumnConstraints halignment="CENTER" minWidth="25.0" prefWidth="25.0"/>
                                </columnConstraints>
                                <!-- Row Constraints: 25px | 600px | 25px -->
                                <rowConstraints>
                                    <RowConstraints minHeight="25.0" prefHeight="25.0" valignment="CENTER"/>
                                    <RowConstraints minHeight="600.0" prefHeight="600.0" valignment="CENTER"/>
                                    <RowConstraints minHeight="25.0" prefHeight="25.0" valignment="CENTER"/>
                                </rowConstraints>


                                <!-- pref-height = 600 / 8 = 75.0 bên trái-->
                                <VBox alignment="CENTER_RIGHT" style=" -fx-padding: 0 5 0 0;" GridPane.columnIndex="0"
                                      GridPane.rowIndex="1">
                                    <Label alignment="CENTER_RIGHT"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-height: 75.0;"
                                           text="8"/>
                                    <Label alignment="CENTER_RIGHT"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-height: 75.0;"
                                           text="7"/>
                                    <Label alignment="CENTER_RIGHT"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-height: 75.0;"
                                           text="6"/>
                                    <Label alignment="CENTER_RIGHT"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-height: 75.0;"
                                           text="5"/>
                                    <Label alignment="CENTER_RIGHT"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-height: 75.0;"
                                           text="4"/>
                                    <Label alignment="CENTER_RIGHT"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-height: 75.0;"
                                           text="3"/>
                                    <Label alignment="CENTER_RIGHT"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-height: 75.0;"
                                           text="2"/>
                                    <Label alignment="CENTER_RIGHT"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-height: 75.0;"
                                           text="1"/>
                                </VBox>

                                <!-- BÀN CỜ CHÍNH (GridPane) -->
                                <GridPane fx:id="chessBoard" gridLinesVisible="true" prefHeight="600" prefWidth="600"
                                          GridPane.columnIndex="1" GridPane.rowIndex="1">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="12.5"/>
                                        <ColumnConstraints percentWidth="12.5"/>
                                        <ColumnConstraints percentWidth="12.5"/>
                                        <ColumnConstraints percentWidth="12.5"/>
                                        <ColumnConstraints percentWidth="12.5"/>
                                        <ColumnConstraints percentWidth="12.5"/>
                                        <ColumnConstraints percentWidth="12.5"/>
                                        <ColumnConstraints percentWidth="12.5"/>
                                    </columnConstraints>
                                    <rowConstraints>
                                        <RowConstraints percentHeight="12.5"/>
                                        <RowConstraints percentHeight="12.5"/>
                                        <RowConstraints percentHeight="12.5"/>
                                        <RowConstraints percentHeight="12.5"/>
                                        <RowConstraints percentHeight="12.5"/>
                                        <RowConstraints percentHeight="12.5"/>
                                        <RowConstraints percentHeight="12.5"/>
                                        <RowConstraints percentHeight="12.5"/>
                                    </rowConstraints>
                                </GridPane>


                                <!-- TỌA ĐỘ NGANG (A-H) Ở DƯỚI  -->
                                <HBox alignment="CENTER" GridPane.columnIndex="1" GridPane.rowIndex="2">
                                    <Label alignment="CENTER"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-width: 75.0;"
                                           text="A"/>
                                    <Label alignment="CENTER"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-width: 75.0;"
                                           text="B"/>
                                    <Label alignment="CENTER"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-width: 75.0;"
                                           text="C"/>
                                    <Label alignment="CENTER"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-width: 75.0;"
                                           text="D"/>
                                    <Label alignment="CENTER"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-width: 75.0;"
                                           text="E"/>
                                    <Label alignment="CENTER"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-width: 75.0;"
                                           text="F"/>
                                    <Label alignment="CENTER"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-width: 75.0;"
                                           text="G"/>
                                    <Label alignment="CENTER"
                                           style="-fx-font-size: 14px; -fx-text-fill: #333333; -fx-pref-width: 75.0;"
                                           text="H"/>
                                </HBox>
                            </GridPane>
                            <AnchorPane prefHeight="33.0" prefWidth="750.0"
                                        style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #333333; ">
                                <children>
                                    <Label fx:id="whitePlayerName" alignment="CENTER_LEFT" layoutX="73.0" layoutY="-1.0"
                                           maxWidth="Infinity" text="Người chơi 1 (Trắng):"/>
                                    <Label fx:id="lNameWhite" alignment="CENTER_LEFT" layoutX="281.0" layoutY="-1.0"
                                           maxWidth="Infinity" text="Đang chờ..."/>
                                    <Label fx:id="whiteTimerLabel" alignment="CENTER_RIGHT" layoutX="600.0" layoutY="-1.0" text="10:00" style="-fx-text-fill: #c0392b;" />
                                </children>
                            </AnchorPane>
                        </VBox>
                        <StackPane fx:id="waitingOverlay" alignment="CENTER" managed="true"
                                   style="-fx-background-color: rgba(20, 24, 28, 0.55);">
                            <VBox alignment="CENTER" spacing="10">
                                <Label style="-fx-text-fill: white; -fx-font-size: 20px; -fx-font-weight: bold;"
                                       text="Chưa tham gia trận đấu"/>
                                <Label maxWidth="360"
                                       style="-fx-text-fill: rgba(255,255,255,0.85); -fx-font-size: 14px;"
                                       text="Hãy tạo phòng, tìm trận nhanh hoặc chọn chế độ nội bộ để bắt đầu."
                                       wrapText="true"/>
                            </VBox>
                        </StackPane>
                        
                        <!-- Countdown Overlay -->
                        <StackPane fx:id="countdownOverlay" alignment="CENTER" managed="false" visible="false"
                                   style="-fx-background-color: rgba(0, 0, 0, 0.3);">
                             <Label fx:id="countdownLabel" text="3" 
                                    style="-fx-font-size: 120px; -fx-font-weight: bold; -fx-text-fill: #e74c3c; -fx-effect: dropshadow(gaussian, black, 10, 0.5, 0, 0);"/>
                        </StackPane>
                    </StackPane>
                </AnchorPane>

                <!-- 3. Panel phải (AnchorPane) -->
                <AnchorPane layoutX="950.0" prefHeight="750.0" prefWidth="350.0" style="-fx-background-color: #f6f8fb;">
                    <VBox fx:id="rightPanelContainer" alignment="TOP_CENTER" prefHeight="750.0" prefWidth="350.0">
                        <padding>
                            <Insets bottom="20.0" left="20.0" right="20.0" top="20.0"/>
                        </padding>

                        <!-- GIAO DIỆN CON 1: HOME/MATCHING VIEW (Mặc định được hiển thị) -->
                        <VBox fx:id="homePanelView" alignment="TOP_CENTER" prefHeight="750.0" prefWidth="350.0"
                              spacing="15">
                            <Label style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"
                                   text="Bắt đầu trận"/>
                            <Button fx:id="quickMatchButton" mnemonicParsing="false" prefHeight="50.0" prefWidth="260.0"
                                    style="-fx-background-color: linear-gradient(to right, #1abc9c, #16a085); -fx-text-fill: white; -fx-font-size: 16px; -fx-font-weight: bold; -fx-background-radius: 10;"
                                    text="Tìm trận nhanh">
                                <VBox.margin>
                                    <Insets top="10.0"/>
                                </VBox.margin>
                            </Button>

                            <Separator prefWidth="200.0">
                                <VBox.margin>
                                    <Insets bottom="10.0" top="10.0"/>
                                </VBox.margin>
                            </Separator>

                            <Label style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #34495e;"
                                   text="Tham gia phòng riêng"/>
                            <TextField fx:id="joinRoomField" prefWidth="260.0" promptText="Nhập mã phòng"
                                       style="-fx-font-size: 15px; -fx-background-radius: 10; -fx-border-color: #cfd8e3; -fx-border-radius: 10; -fx-padding: 10;"/>
                            <Button fx:id="joinRoomButton" mnemonicParsing="false" prefHeight="42.0" prefWidth="260.0"
                                    style="-fx-background-color: linear-gradient(to right, #2980b9, #3498db); -fx-text-fill: white; -fx-font-size: 15px; -fx-font-weight: bold; -fx-background-radius: 10;"
                                    text="Tham gia"/>

                            <Label style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #34495e;"
                                   text="Tạo phòng mới">
                                <VBox.margin>
                                    <Insets top="20.0"/>
                                </VBox.margin>
                            </Label>
                            <Button fx:id="createRoomButton" mnemonicParsing="false" prefHeight="42.0" prefWidth="260.0"
                                    style="-fx-background-color: linear-gradient(to right, #e67e22, #d35400); -fx-text-fill: white; -fx-font-size: 15px; -fx-font-weight: bold; -fx-background-radius: 10;"
                                    text="Tạo phòng"/>
                        </VBox>

                        <!-- GIAO DIỆN CON 2: GAME VIEW (Mặc định ẩn) -->
                        <VBox fx:id="gamePanelView" alignment="TOP_LEFT" managed="false" prefHeight="750.0"
                              prefWidth="350.0" spacing="12" visible="false">

                            <VBox spacing="8"
                                  style="-fx-background-color: linear-gradient(to right, #233442, #3b5f87); -fx-background-radius: 14; -fx-padding: 14; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.16), 16, 0.2, 0, 4); -fx-max-width: 320;">
                                <HBox alignment="CENTER_LEFT" spacing="8">
                                    <Label text="⚡"
                                           style="-fx-font-size: 16px; -fx-text-fill: rgba(255,255,255,0.85);"/>
                                    <Label text="Trạng thái trận đấu"
                                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label fx:id="statusLabel" text="ĐANG DIỄN RA" ellipsisString="…" maxWidth="120"
                                           style="-fx-text-fill: #17304c; -fx-font-size: 11px; -fx-font-weight: bold; -fx-background-color: rgba(255,255,255,0.85); -fx-padding: 4 10; -fx-background-radius: 999;"/>
                                </HBox>
                                <Separator opacity="0.35"/>
                                <VBox spacing="4">
                                    <Label text="Lượt hiện tại"
                                           style="-fx-text-fill: rgba(255,255,255,0.8); -fx-font-size: 11px;"/>
                                    <Label fx:id="turnLabel" text="TRẮNG" ellipsisString="…" maxWidth="280"
                                           style="-fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: bold; -fx-background-color: rgba(255,255,255,0.16); -fx-padding: 6 14; -fx-background-radius: 10;"/>
                                </VBox>
                            </VBox>

                            <!-- Hiển thị địa chỉ/ID phòng -->
                            <VBox spacing="12"
                                  style="-fx-background-color: white; -fx-background-radius: 14; -fx-padding: 14; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 18, 0.15, 0, 4);">
                                <HBox alignment="CENTER_LEFT" spacing="10">
                                    <Label style="-fx-font-size: 13px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"
                                           text="Mã phòng/IP:"/>
                                    <Label fx:id="roomIdLabel"
                                           style="-fx-font-size: 13px; -fx-text-fill: #c0392b; -fx-font-weight: bold;"
                                           text="[Chưa kết nối]"/>
                                </HBox>
                                <VBox.margin>
                                    <Insets top="4.0"/>
                                </VBox.margin>
                                <Separator/>
                                <VBox spacing="6">
                                    <Label style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"
                                           text="Lịch sử nước đi"/>
                                    <StackPane
                                            style="-fx-background-color: rgba(23,48,76,0.04); -fx-border-color: rgba(23,48,76,0.12); -fx-border-radius: 12; -fx-background-radius: 12; -fx-padding: 6;"
                                            VBox.vgrow="ALWAYS">
                                        <ListView fx:id="moveListView" prefHeight="360.0" prefWidth="300.0"
                                                  VBox.vgrow="ALWAYS"
                                                  style="-fx-background-color: transparent; -fx-border-color: transparent; -fx-control-inner-background: transparent; -fx-padding: 4;"/>
                                    </StackPane>
                                </VBox>
                            </VBox>

                            <HBox spacing="10">
                                <Button fx:id="undoButton" mnemonicParsing="false" prefHeight="45.0" prefWidth="135.0"
                                        style="-fx-background-color: #8e44ad; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold; -fx-background-radius: 10;"
                                        text="Hoàn tác"/>
                                <Button fx:id="pauseButton" mnemonicParsing="false" prefHeight="45.0" prefWidth="135.0"
                                        style="-fx-background-color: #f39c12; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold; -fx-background-radius: 10;"
                                        text="Tạm dừng"/>
                            </HBox>

                            <HBox spacing="10">
                                <Button fx:id="resignButton" mnemonicParsing="false" prefHeight="45.0" prefWidth="135.0"
                                        style="-fx-background-color: #c0392b; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold; -fx-background-radius: 10;"
                                        text="Đầu hàng"/>
                                <Button fx:id="drawButton" mnemonicParsing="false" prefHeight="45.0" prefWidth="135.0"
                                        style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold; -fx-background-radius: 10;"
                                        text="Cầu hòa"/>
                            </HBox>

                            <HBox spacing="10">
                                <Button fx:id="exitRoomButton" mnemonicParsing="false" prefHeight="45.0" prefWidth="280.0"
                                        style="-fx-background-color: #7f8c8d; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold; -fx-background-radius: 10;"
                                        text="Thoát phòng"/>
                            </HBox>

                            <Button fx:id="newGameButton" mnemonicParsing="false" prefHeight="45.0" prefWidth="280.0"
                                    style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-size: 15px; -fx-font-weight: bold; -fx-background-radius: 10;"
                                    text="Ván mới">
                                <VBox.margin>
                                    <Insets top="0.0"/>
                                </VBox.margin>
                            </Button>

                            <Label fx:id="tipLabel"
                                   style="-fx-text-fill: #2c3e50; -fx-font-size: 13px; -fx-background-color: rgba(46, 204, 113, 0.15); -fx-padding: 10; -fx-background-radius: 8;"
                                   text="Mẹo: Nhấp vào quân để xem các nước đi hợp lệ." wrapText="true"/>

                        </VBox>

                    </VBox>
                </AnchorPane>
            </children>
        </AnchorPane>
    </children>
</StackPane>
